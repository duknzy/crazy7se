<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>High-Speed Vocabulary Quiz - World Tour</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap');
        
        body {
            background-color: #0b0e14;
            color: #e2e8f0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .f1-font {
            font-family: 'Orbitron', sans-serif;
        }

        .race-card {
            background: linear-gradient(145deg, #1a1f2e, #111521);
            border-left: 4px solid #e10600;
        }

        .option-btn {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .option-btn:hover {
            transform: translateX(10px);
            background-color: #e10600;
            color: white;
        }

        .progress-bar {
            height: 4px;
            background-color: #333;
            width: 100%;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background-color: #e10600;
            transition: width 0.3s ease;
        }

        .checkered-pattern {
            background-image: linear-gradient(45deg, #222 25%, transparent 25%), 
                              linear-gradient(-45deg, #222 25%, transparent 25%), 
                              linear-gradient(45deg, transparent 75%, #222 75%), 
                              linear-gradient(-45deg, transparent 75%, #222 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
        }

        .pass-card {
            background: linear-gradient(135deg, #ffd700, #ff8c00);
            color: #000;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <div id="app" class="w-full max-w-2xl">
        <div id="champion-screen" class="hidden race-card p-10 rounded-lg shadow-2xl text-center border-4 border-yellow-500">
            <h1 class="f1-font text-5xl mb-6 font-bold text-yellow-500 tracking-widest">CHAMPION ENTRY</h1>
            <div class="pass-card p-6 rounded-lg mb-8">
                <p class="f1-font text-sm uppercase font-bold mb-2">Access Granted</p>
                <h2 class="text-3xl font-black">SUPER LICENSE PASS</h2>
                <p id="pass-id" class="mt-4 font-mono text-xs opacity-75"></p>
                <button id="copy-existing-pass" class="mt-4 bg-black/20 hover:bg-black/40 text-black text-xs px-4 py-2 rounded-full font-bold transition-all">
                    Copy License ID
                </button>
            </div>
            <p class="mb-8 text-gray-300">お前はすでにこのコースの覇者だ。再戦するか、あるいはさらなる高みを目指せ。</p>
            <div class="flex flex-col gap-4">
                <button onclick="quiz.start()" class="f1-font bg-white text-black px-12 py-4 rounded-full font-bold tracking-tighter uppercase transition-transform active:scale-95">
                    Re-Race (Random Track)
                </button>
                <button onclick="quiz.revokePass()" class="text-gray-500 text-xs hover:underline">Revoke License (Reset)</button>
            </div>
        </div>

        <div id="start-screen" class="race-card p-8 rounded-lg shadow-2xl text-center">
            <h1 class="f1-font text-4xl mb-6 font-bold text-white tracking-widest">VOCABULARY GP</h1>
            <p class="mb-2 text-gray-400">ワールドツアーモード：全3コースからランダム選出</p>
            <div class="bg-red-900/30 border border-red-500 p-3 rounded mb-8">
                <p class="text-red-500 font-bold text-sm">LICENSE CRITERIA: Accuracy 90%+</p>
                <p class="text-xs text-gray-400">ミス2回以内で合格。PASSが発行される。</p>
            </div>
            <button onclick="quiz.start()" class="f1-font bg-red-600 hover:bg-red-700 text-white px-12 py-4 rounded-full font-bold tracking-tighter uppercase transition-transform active:scale-95">
                Start Engine
            </button>
        </div>

        <div id="quiz-screen" class="hidden race-card p-6 rounded-lg shadow-2xl">
            <div class="flex justify-between items-center mb-4">
                <span id="question-number" class="f1-font text-red-500 font-bold">LAP 1 / 20</span>
                <span id="circuit-name" class="f1-font text-xs text-gray-500 uppercase tracking-widest">Circuit: Random</span>
                <span id="timer" class="f1-font text-xl text-yellow-400">0.00s</span>
            </div>
            <div class="progress-bar mb-8">
                <div id="progress-fill" class="progress-fill" style="width: 0%"></div>
            </div>

            <div class="mb-10 text-center">
                <p class="text-gray-400 text-sm uppercase tracking-widest mb-2">Meaning of:</p>
                <h2 id="target-word" class="f1-font text-5xl font-bold text-white mb-4">word</h2>
            </div>

            <div id="options-container" class="grid gap-4"></div>
            <div id="feedback" class="mt-4 text-center h-6 font-bold"></div>
        </div>

        <div id="result-screen" class="hidden race-card p-8 rounded-lg shadow-2xl text-center">
            <h2 class="f1-font text-3xl mb-4 font-bold text-white">RACE FINISHED</h2>
            <div class="checkered-pattern h-12 w-full mb-6 rounded"></div>
            
            <div id="accuracy-display" class="text-4xl font-bold mb-2">95.0%</div>
            <p id="rank-text" class="f1-font text-sm mb-6 text-gray-300">P1: WORLD CHAMPION</p>

            <div id="pass-issue-area" class="hidden mb-8 p-6 rounded-lg pass-card animate-bounce">
                <h3 class="font-black text-2xl mb-1">PASS GRANTED!</h3>
                <p class="text-sm mb-3">SUPER LICENSE ISSUED</p>
                <button id="copy-pass-btn" class="bg-black text-white text-xs px-6 py-2 rounded-full font-bold hover:scale-105 transition-transform">
                    COPY LICENSE ID
                </button>
            </div>

            <div id="fail-message" class="hidden mb-8 p-4 border border-red-500 text-red-500 font-bold">
                LICENSE DENIED: Accuracy below 90%
            </div>

            <div class="bg-black/30 p-4 rounded mb-8 text-left max-h-48 overflow-y-auto" id="review-list"></div>

            <div class="flex gap-4 justify-center">
                <button onclick="location.reload()" class="f1-font border-2 border-white hover:bg-white hover:text-black text-white px-8 py-3 rounded-full font-bold transition-all">
                    Back to Garage
                </button>
            </div>
        </div>
    </div>

    <script>
// --- WORLD TOUR DATA: 3つの異なる単語セット ---
const allCircuits = [
    // Round 1: The Classics (基本セット)
    {
        name: "ROUND 1: ORIGINS",
        words: [
            { w: "substitute", m: "代わりにする", o: ["維持する", "代わりにする", "無視する", "破壊する"] },
            { w: "trace", m: "跡をたどる", o: ["跡をたどる", "止まる", "忘れる", "捨てる"] },
            { w: "interrupt", m: "邪魔する", o: ["助ける", "続ける", "認める", "邪魔する"] },
            { w: "confront", m: "直面する", o: ["直面する", "逃げる", "隠れる", "同意する"] },
            { w: "illustrate", m: "説明する", o: ["混乱させる", "説明する", "隠す", "否定する"] },
            { w: "arrest", m: "逮捕する", o: ["逮捕する", "解放する", "雇う", "招待する"] },
            { w: "stimulate", m: "刺激する", o: ["落ち着かせる", "刺激する", "止める", "弱める"] },
            { w: "assure", m: "保証する", o: ["保証する", "疑う", "嘘をつく", "拒否する"] },
            { w: "consult", m: "相談する", o: ["相談する", "命令する", "無視する", "批判する"] },
            { w: "depress", m: "意気消沈させる", o: ["喜ばせる", "意気消沈させる", "励ます", "祝う"] },
            { w: "crash", m: "衝突する", o: ["修理する", "避ける", "止まる", "衝突する"] },
            { w: "inspire", m: "鼓舞する", o: ["鼓舞する", "失望させる", "邪魔する", "怖がらせる"] },
            { w: "specialize", m: "専門とする", o: ["一般化する", "専門とする", "広く浅くやる", "やめる"] },
            { w: "cultivate", m: "耕す", o: ["壊す", "放置する", "耕す", "捨てる"] },
            { w: "fulfill", m: "満たす", o: ["満たす", "失敗する", "無視する", "空にする"] },
            { w: "transmit", m: "送る", o: ["送る", "受け取る", "隠す", "止める"] },
            { w: "found", m: "設立する", o: ["破壊する", "見つける", "設立する", "閉鎖する"] },
            { w: "clap", m: "拍手する", o: ["拍手する", "叩く", "投げる", "歌う"] },
            { w: "burst", m: "破裂する", o: ["固まる", "破裂する", "縮む", "続く"] },
            { w: "bow", m: "おじぎする", o: ["直立する", "走る", "跳ぶ", "おじぎする"] }
        ]
    },
    // Round 2: Business & Logic (硬めの表現)
    {
        name: "ROUND 2: STRATEGY",
        words: [
            { w: "dismiss", m: "退ける/解雇する", o: ["採用する", "退ける/解雇する", "昇進させる", "歓迎する"] },
            { w: "breed", m: "繁殖させる", o: ["絶滅させる", "繁殖させる", "買う", "隠す"] },
            { w: "prohibit", m: "禁止する", o: ["許可する", "奨励する", "禁止する", "無視する"] },
            { w: "oblige", m: "義務付ける", o: ["頼む", "義務付ける", "自由にする", "防ぐ"] },
            { w: "qualify", m: "資格を与える", o: ["剥奪する", "資格を与える", "テストする", "疑う"] },
            { w: "invest", m: "投資する", o: ["浪費する", "投資する", "貯金する", "盗む"] },
            { w: "grasp", m: "把握する", o: ["手放す", "投げる", "把握する", "見落とす"] },
            { w: "collapse", m: "崩壊する", o: ["建設する", "崩壊する", "強化する", "伸びる"] },
            { w: "overlook", m: "見落とす", o: ["見落とす", "監視する", "詳細に見る", "気づく"] },
            { w: "accuse", m: "非難する", o: ["賞賛する", "許す", "非難する", "助ける"] },
            { w: "frustrate", m: "欲求不満にさせる", o: ["満足させる", "欲求不満にさせる", "喜ばせる", "助ける"] },
            { w: "deprive", m: "奪う", o: ["与える", "奪う", "貸す", "増やす"] },
            { w: "astonish", m: "驚嘆させる", o: ["退屈させる", "驚嘆させる", "眠らせる", "安心させる"] },
            { w: "register", m: "登録する", o: ["削除する", "登録する", "忘れる", "無視する"] },
            { w: "correspond", m: "一致する/文通する", o: ["矛盾する", "一致する/文通する", "戦う", "無視する"] },
            { w: "cast", m: "投げる/役を割り当てる", o: ["受け取る", "隠す", "投げる/役を割り当てる", "壊す"] },
            { w: "attribute", m: "〜のせいにする", o: ["〜のせいにする", "感謝する", "無視する", "自分で行う"] },
            { w: "neglect", m: "無視する/怠る", o: ["大切にする", "集中する", "無視する/怠る", "修理する"] },
            { w: "starve", m: "飢える", o: ["満腹になる", "飢える", "料理する", "楽しむ"] },
            { w: "resolve", m: "解決する/決意する", o: ["混乱させる", "解決する/決意する", "諦める", "忘れる"] }
        ]
    },
    // Round 3: Action & Impact (動きと変化)
    {
        name: "ROUND 3: DYNAMICS",
        words: [
            { w: "impose", m: "課す/押しつける", o: ["取り除く", "課す/押しつける", "提案する", "避ける"] },
            { w: "convert", m: "転換する/改宗させる", o: ["維持する", "転換する/改宗させる", "破壊する", "拒絶する"] },
            { w: "scare", m: "怖がらせる", o: ["安心させる", "怖がらせる", "笑わせる", "眠らせる"] },
            { w: "appoint", m: "任命する", o: ["解任する", "任命する", "無視する", "隠す"] },
            { w: "imply", m: "ほのめかす", o: ["断言する", "ほのめかす", "叫ぶ", "否定する"] },
            { w: "assign", m: "割り当てる", o: ["取り消す", "割り当てる", "独占する", "捨てる"] },
            { w: "declare", m: "宣言する", o: ["隠す", "宣言する", "囁く", "疑う"] },
            { w: "examine", m: "調査する", o: ["無視する", "調査する", "壊す", "信じる"] },
            { w: "manufacture", m: "製造する", o: ["破壊する", "消費する", "製造する", "買う"] },
            { w: "accompany", m: "同行する", o: ["置き去りにする", "同行する", "避ける", "攻撃する"] },
            { w: "dominate", m: "支配する", o: ["服従する", "支配する", "逃げる", "助ける"] },
            { w: "whisper", m: "ささやく", o: ["叫ぶ", "ささやく", "歌う", "黙る"] },
            { w: "mount", m: "据え付ける/登る", o: ["降りる", "取り外す", "据え付ける/登る", "壊す"] },
            { w: "tread", m: "歩く/踏む", o: ["飛ぶ", "泳ぐ", "歩く/踏む", "止まる"] },
            { w: "emerge", m: "現れる", o: ["消える", "現れる", "隠れる", "沈む"] },
            { w: "settle", m: "定住する/解決する", o: ["移動する", "定住する/解決する", "混乱させる", "始める"] },
            { w: "abuse", m: "虐待する/乱用する", o: ["大切にする", "虐待する/乱用する", "褒める", "直す"] },
            { w: "screw", m: "ねじで留める", o: ["釘を打つ", "ねじで留める", "接着する", "緩める"] },
            { w: "curve", m: "曲がる", o: ["直進する", "曲がる", "止まる", "落ちる"] },
            { w: "pump", m: "ポンプで送る", o: ["吸い込む", "ポンプで送る", "止める", "飲む"] }
        ]
    }
];

        class VocabularyQuiz {
            constructor() {
                this.currentIndex = 0;
                this.missCount = 0;
                this.startTime = 0;
                this.timerInterval = null;
                this.questions = [];
                this.missedWordsLog = [];
                this.currentCircuitName = "";
                this.init();
            }

            init() {
                // 保存キー 'PASS' で統一
                const savedPass = localStorage.getItem('PASS');
                if (savedPass) {
                    document.getElementById('start-screen').classList.add('hidden');
                    document.getElementById('champion-screen').classList.remove('hidden');
                    document.getElementById('pass-id').innerText = `LICENSE_ID: ${savedPass}`;
                    
                    document.getElementById('copy-existing-pass').onclick = () => {
                        this.copyToClipboard(savedPass, document.getElementById('copy-existing-pass'));
                    };
                }
            }

            copyToClipboard(text, btnElement) {
                navigator.clipboard.writeText(text).then(() => {
                    const originalText = btnElement.innerText;
                    btnElement.innerText = "COPIED!";
                    btnElement.style.backgroundColor = "#4ade80";
                    setTimeout(() => {
                        btnElement.innerText = originalText;
                        btnElement.style.backgroundColor = "";
                    }, 2000);
                });
            }

            start() {
                // ランダムにサーキット（単語セット）を選択
                const randomCircuitIndex = Math.floor(Math.random() * allCircuits.length);
                const selectedData = allCircuits[randomCircuitIndex];
                
                this.currentCircuitName = selectedData.name;
                this.questions = [...selectedData.words].sort(() => Math.random() - 0.5);
                
                this.currentIndex = 0;
                this.missCount = 0;
                this.missedWordsLog = [];
                
                document.getElementById('circuit-name').innerText = this.currentCircuitName;

                document.getElementById('start-screen').classList.add('hidden');
                document.getElementById('champion-screen').classList.add('hidden');
                document.getElementById('result-screen').classList.add('hidden');
                document.getElementById('quiz-screen').classList.remove('hidden');
                
                this.startTime = Date.now();
                this.startTimer();
                this.showQuestion();
            }

            startTimer() {
                if (this.timerInterval) clearInterval(this.timerInterval);
                this.timerInterval = setInterval(() => {
                    const elapsed = (Date.now() - this.startTime) / 1000;
                    document.getElementById('timer').innerText = elapsed.toFixed(2) + 's';
                }, 50);
            }

            showQuestion() {
                const q = this.questions[this.currentIndex];
                document.getElementById('question-number').innerText = `LAP ${this.currentIndex + 1} / ${this.questions.length}`;
                document.getElementById('target-word').innerText = q.w;
                document.getElementById('progress-fill').style.width = `${(this.currentIndex / this.questions.length) * 100}%`;
                document.getElementById('feedback').innerText = '';

                const container = document.getElementById('options-container');
                container.innerHTML = '';

                const shuffledOptions = [...q.o].sort(() => Math.random() - 0.5);

                shuffledOptions.forEach(option => {
                    const btn = document.createElement('button');
                    btn.className = 'option-btn w-full text-left p-4 rounded bg-white/5 border border-white/10 hover:border-red-500 font-medium text-lg';
                    btn.innerText = option;
                    btn.onclick = () => this.handleAnswer(option, q);
                    container.appendChild(btn);
                });
            }

            handleAnswer(selected, questionObj) {
                const feedback = document.getElementById('feedback');
                
                if (selected === questionObj.m) {
                    this.currentIndex++;
                    if (this.currentIndex < this.questions.length) {
                        this.showQuestion();
                    } else {
                        this.finish();
                    }
                } else {
                    this.missCount++;
                    feedback.innerText = `WRONG: ${questionObj.w} = ${questionObj.m}`;
                    feedback.className = "mt-4 text-center h-6 font-bold text-red-500";
                    
                    if (!this.missedWordsLog.find(item => item.w === questionObj.w)) {
                        this.missedWordsLog.push({ w: questionObj.w, m: questionObj.m });
                    }
                    this.questions.push(questionObj);
                    
                    const btns = document.querySelectorAll('.option-btn');
                    btns.forEach(b => b.disabled = true);
                    
                    setTimeout(() => {
                        this.currentIndex++;
                        this.showQuestion();
                    }, 1200);
                }
            }

            finish() {
                clearInterval(this.timerInterval);
                document.getElementById('quiz-screen').classList.add('hidden');
                document.getElementById('result-screen').classList.remove('hidden');

                const totalTime = (Date.now() - this.startTime) / 1000;
                const accuracy = (20 / (20 + this.missCount)) * 100; // 常に20問ベース
                
                const accDisplay = document.getElementById('accuracy-display');
                accDisplay.innerText = `${accuracy.toFixed(1)}%`;
                
                const passArea = document.getElementById('pass-issue-area');
                const failMsg = document.getElementById('fail-message');

                if (accuracy >= 90) {
                    accDisplay.style.color = "#4ade80";
                    passArea.classList.remove('hidden');
                    failMsg.classList.add('hidden');
                    
                    const passId = "STUDY";
                    localStorage.setItem('PASS', passId);

                    const copyBtn = document.getElementById('copy-pass-btn');
                    copyBtn.onclick = () => this.copyToClipboard(passId, copyBtn);
                } else {
                    accDisplay.style.color = "#ef4444";
                    passArea.classList.add('hidden');
                    failMsg.classList.remove('hidden');
                }

                document.getElementById('rank-text').innerText = `${this.currentCircuitName} | Time: ${totalTime.toFixed(2)}s | Misses: ${this.missCount}`;

                const review = document.getElementById('review-list');
                let summaryHtml = `<div class="mb-4 font-bold text-white uppercase">Final Stats:</div>`;
                if (this.missedWordsLog.length > 0) {
                    summaryHtml += '<h3 class="text-red-500 mb-2 font-bold uppercase text-xs">Words requiring recovery:</h3>' + 
                        this.missedWordsLog.map(item => `<div class="mb-1 text-xs"><span class="font-bold text-white">${item.w}</span>: ${item.m}</div>`).join('');
                } else {
                    summaryHtml += '<p class="text-green-500 font-bold">Flawless Race.</p>';
                }
                review.innerHTML = summaryHtml;
            }

            revokePass() {
                localStorage.removeItem('PASS');
                location.reload();
            }
        }

        const quiz = new VocabularyQuiz();
    </script>
</body>
</html>